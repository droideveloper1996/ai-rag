<!DOCTYPE html>
<html lang="en" class="dark">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Brainwave Assistant</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.0/css/font-awesome.min.css"
    />
  </head>
  <body
    class="bg-gray-100 dark:bg-gray-900 text-gray-800 dark:text-gray-100 font-sans"
  >
    <div class="flex h-screen overflow-hidden">
      <!-- Overlay for mobile -->
      <div
        id="overlay"
        class="fixed inset-0 bg-black bg-opacity-50 z-40 hidden lg:hidden"
        onclick="toggleSidebar()"
      ></div>

      <!-- Sidebar -->
      <aside
        id="sidebar"
        class="fixed lg:relative z-50 top-0 left-0 h-full w-64 bg-black text-white flex flex-col p-4 transition-transform duration-300 -translate-x-full lg:translate-x-0"
      >
        <div class="flex items-center justify-between">
          <div class="text-xl font-bold flex items-center space-x-2">
            <img
              src="/static/uploads/site_logo.png"
              alt="Logo"
              class="w-12 h-12 rounded-full text-white"
            />
            <span>Brainwave</span>
          </div>
          <button
            class="lg:hidden text-white text-xl"
            onclick="toggleSidebar()"
          >
            âœ•
          </button>
        </div>
        <nav class="flex-1 mt-6 space-y-2 text-sm">
          <a href="#" class="block px-3 py-2 bg-gray-800 rounded">Chats</a>
          <a href="/upload" class="block px-3 py-2 hover:bg-gray-700 rounded"
            >Upload Knowledge</a
          >
          <a href="#" class="block px-3 py-2 hover:bg-gray-700 rounded"
            >Subscription</a
          >
          <a href="#" class="block px-3 py-2 hover:bg-gray-700 rounded"
            >Updates & FAQ</a
          >
          <a href="#" class="block px-3 py-2 hover:bg-gray-700 rounded"
            >Settings</a
          >
        </nav>
        <div
          class="mt-auto flex items-center justify-between pt-4 border-t border-gray-700"
        >
          <div>
            <p class="text-sm font-semibold">Tran Mau Tri Tam</p>
            <p class="text-xs text-green-400">Free</p>
          </div>
          <button
            class="text-xs bg-indigo-500 hover:bg-indigo-600 px-2 py-1 rounded"
          >
            Upgrade
          </button>
        </div>
      </aside>

      <!-- Main Content -->
      <main
        class="flex-1 flex flex-col transition-all bg-white text-black rounded-2xl mx-2 my-2 md:mx-10 md:my-10"
      >
        <!-- Header -->
        <div
          class="flex justify-between items-center p-4 border-b border-gray-200 dark:border-gray-700"
        >
          <div class="flex items-center gap-3">
            <button class="lg:hidden text-xl" onclick="toggleSidebar()">
              â˜°
            </button>
            <h1 class="text-xl font-semibold">Brain Wave Assistant</h1>
          </div>
        </div>

        <!-- Chat area -->
        <div class="flex-1 flex overflow-hidden">
          <!-- Chat messages -->
          <div
            id="chat-window"
            class="flex-1 flex flex-col p-6 overflow-y-auto space-y-4"
          >
            <div class="bg-gray-800 text-white p-4 rounded-lg">
              Hello! How can I help you today?
            </div>
            <!-- <div class="bg-gray-200 dark:bg-gray-700 p-4 rounded-lg self-end">
              Show me what you can do
            </div> -->
            <!-- <div class="bg-gray-800 text-white p-4 rounded-lg"> -->
            <!-- <p>I'm Brainwave - a versatile and powerful tool...</p> -->
            <!-- <div class="flex flex-wrap mt-2 gap-2">
                <span class="bg-purple-600 px-3 py-1 rounded-full text-sm"
                  >Photo edition</span
                >
                <span class="bg-orange-600 px-3 py-1 rounded-full text-sm"
                  >Video generation</span
                >
                <span class="bg-blue-600 px-3 py-1 rounded-full text-sm"
                  >Photo generation</span
                >
                <span class="bg-green-600 px-3 py-1 rounded-full text-sm"
                  >Code generation</span
                >
                <span class="bg-yellow-500 px-3 py-1 rounded-full text-sm"
                  >Audio generation</span
                >
              </div> -->
            <!-- </div> -->
          </div>

          <!-- Chat history (hidden on mobile) -->
          <!-- <div
            class="hidden md:block w-80 bg-white dark:bg-gray-800 p-4 border-l border-gray-200 dark:border-gray-700 overflow-y-auto"
          >
            <h2 class="text-sm font-semibold mb-2">Chat History</h2>
            <div class="space-y-2">
              <div
                class="p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded cursor-pointer"
              >
                <p class="text-sm font-medium">Hello</p>
                <p class="text-xs text-gray-500">Show me what you can do</p>
              </div>
              <div
                class="p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded cursor-pointer"
              >
                <p class="text-sm font-medium">Photo retouch</p>
                <p class="text-xs text-gray-500">Anime travelers couple...</p>
              </div>
            </div>
          </div> -->
        </div>

        <!-- Chat input -->
        <form
          id="chat-form"
          enctype="multipart/form-data"
          class="p-4 border-t border-gray-200 dark:border-gray-700 flex items-center gap-2"
        >
          <!-- File Upload Button -->
          <label
            for="file-upload"
            class="cursor-pointer flex items-center px-3 py-2 border rounded dark:border-gray-600 bg-white dark:bg-gray-800 hover:bg-gray-100 dark:hover:bg-gray-700 transition text-sm"
          >
            ðŸ“Ž
            <input type="file" id="file-upload" name="file" class="hidden" />
          </label>

          <!-- Text Input -->
          <input
            id="query"
            type="text"
            placeholder="Type '/' for commands"
            class="flex-1 p-2 rounded-lg border border-gray-300 light:border-gray-600 light:bg-gray-800 dark-black light:text-white"
          />

          <!-- Submit Button -->
          <button
            type="submit"
            class="px-4 py-2 bg-indigo-600 hover:bg-indigo-700 text-white rounded transition"
          >
            Send
          </button>
        </form>
      </main>
    </div>

    <script>
      function toggleSidebar() {
        const sidebar = document.getElementById("sidebar");
        const overlay = document.getElementById("overlay");
        sidebar.classList.toggle("-translate-x-full");
        overlay.classList.toggle("hidden");
      }

      const form = document.getElementById("chat-form");
      const queryInput = document.getElementById("query");
      const chatWindow = document.getElementById("chat-window");

      const createBubble = (text, isUser = false) => {
        const div = document.createElement("div");
        div.className = `max-w-xl px-4 py-3 text-base leading-relaxed shadow-sm whitespace-pre-wrap break-words ${
          isUser
            ? "self-end bg-blue-100 text-gray-900 dark:bg-blue-600 dark:text-white rounded-2xl rounded-br-sm"
            : "bg-gray-200 text-gray-900 dark:bg-gray-700 dark:text-white rounded-2xl rounded-bl-sm"
        }`;
        div.textContent = text;
        return div;
      };

      form.addEventListener("submit", async (e) => {
        e.preventDefault();
        const query = queryInput.value.trim();
        if (!query) return;

        const userMsg = createBubble(query, true);
        chatWindow.appendChild(userMsg);
        queryInput.value = "";
        chatWindow.scrollTop = chatWindow.scrollHeight;

        const botMsg = createBubble("Thinking...", false);
        chatWindow.appendChild(botMsg);

        const res = await fetch("/query", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ query }),
        });

        const data = await res.json();
        botMsg.textContent = data.answer || "No response.";
        chatWindow.scrollTop = chatWindow.scrollHeight;
      });
    </script>
  </body>
</html>
